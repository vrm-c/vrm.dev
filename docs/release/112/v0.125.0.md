# ğŸš§ âš¡ v0.125.0 VRMShaders ã®æ•´ç†

https://github.com/vrm-c/UniVRM/milestone/90

:::note VRMShaders ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ UniGLTF ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«åˆæµã—ã¦æ•´ç†ã—ã¾ã—ãŸ

https://github.com/vrm-c/UniVRM/issues/2337

```json
`// Packages/manifest.json
{
  "dependencies": {
    // v0.125.0 ã‹ã‚‰ com.vrmc.vrmshaders ã®è¨˜è¿°ã¯ä¸è¦ã«ãªã‚Šã¾ã™ã€‚
    "com.vrmc.vrmshaders": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRMShaders#v0.124.2",
  }
}
```

:::

:::info `VRMC_springBone_extended_collider` spec version `1.0`

https://github.com/vrm-c/UniVRM/issues/2388

:::

:::info Resources ã®æ•´ç†

https://github.com/vrm-c/UniVRM/issues/1341

:::

:::note é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URPåŒ–

https://github.com/vrm-c/UniVRM/pull/2378

:::

:::note URP å¯¾å¿œçŠ¶æ³

[1_112_urp](/api/0_112_urp/)

:::

:::note exporter ã® URP å¯¾å¿œç€æ‰‹

https://github.com/vrm-c/UniVRM/pull/2390

:::

:::note URP ã® editor import æœªå¯¾å¿œ

https://github.com/vrm-c/UniVRM/pull/2375

:::

## `Resources` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ã‚·ã‚§ãƒ¼ãƒ€ç§»å‹•ã«ã¨ã‚‚ãªã†å¯¾å¿œ

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰æ™‚é–“çŸ­ç¸®ãƒ»ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºå‰Šæ¸›ã®ãŸã‚ã€UniVRM ã® `Resources` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚·ã‚§ãƒ¼ãƒ€ã‚’ç§»å‹•ã—ã¾ã—ãŸã€‚
ã“ã‚Œã«ä¼´ã„ã€ã„ãã¤ã‹ã®ã‚·ã‚§ãƒ¼ãƒ€ã‚’ Unity ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

è©³ã—ãã¯ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

:::info
[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Build ã™ã‚‹ã«ã¯ - https://vrm.dev/api/build/](https://vrm.dev/api/build/)
:::

### glTF ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã‚¢ãƒ—ãƒªã®å ´åˆ
RenderPipeline ã«å¿œã˜ã¦ä»¥ä¸‹ã®ã‚·ã‚§ãƒ¼ãƒ€ã‚’ Project Settings ã® Always Included Shaders ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

|  | Built-in RP | URP |
| --- | --- | --- |
| `Standard` | âœ… | - |
| `Univesal Render Pipeline/Lit` | - | âœ… |
| `UniGLTF/UniUnlit` | âœ… | âœ… |

### VRM 0.X ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã‚¢ãƒ—ãƒªã®å ´åˆ
RenderPipeline ã«å¿œã˜ã¦ä»¥ä¸‹ã®ã‚·ã‚§ãƒ¼ãƒ€ã‚’ Project Settings ã® Always Included Shaders ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

|  | Built-in RP | URP |
| --- | --- | --- |
| `Standard` | âœ… | - |
| `Univesal Render Pipeline/Lit` | - | âœ… |
| `UniGLTF/UniUnlit` | âœ… | âœ… |
| `VRM/MToon` | âœ… | - |
| URPç”¨ MToon ã‚·ã‚§ãƒ¼ãƒ€(æœªå®Ÿè£…) | - | - |

### VRM 1.0 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã‚¢ãƒ—ãƒªã®å ´åˆ
RenderPipeline ã«å¿œã˜ã¦ä»¥ä¸‹ã®ã‚·ã‚§ãƒ¼ãƒ€ã‚’ Project Settings ã® Always Included Shaders ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

|  | Built-in RP | URP |
| --- | --- | --- |
| `Standard` | âœ… | - |
| `Univesal Render Pipeline/Lit` | - | âœ… |
| `UniGLTF/UniUnlit` | âœ… | âœ… |
| `VRM10/MToon10` | âœ… | - |
| `VRM10/Universal Render Pipeline/MToon10` | - | âœ… |




:::note è©³ã—ã„å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã® PR ã‚’å‚ç…§
https://github.com/vrm-c/UniVRM/pull/2389
:::

## `com.vrmc.vrmshaders` UPM ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å»ƒæ­¢ã«ã¨ã‚‚ãªã†å¯¾å¿œ

### UPM Package ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã®æ›´æ–°æ‰‹é †
1. `Packages/manifest.json` ã‹ã‚‰ `com.vrmc.vrmshaders` ã®è¨˜è¿°ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
2. `Packages/manifest.json` ã® `com.vrmc.*` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æŒ‡å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ `v0.125.0` ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

Before
```json
{
  "dependencies": {
    "com.vrmc.vrmshaders": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRMShaders#v0.124.2",
    "com.vrmc.gltf": "https://github.com/vrm-c/UniVRM.git?path=/Assets/UniGLTF#v0.124.2",
    "com.vrmc.univrm": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRM#v0.124.2",
    "com.vrmc.vrm": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRM10#v0.124.2",
    // ...
  }
}
```

After
```json
{
  "dependencies": {
    "com.vrmc.gltf": "https://github.com/vrm-c/UniVRM.git?path=/Assets/UniGLTF#v0.125.0",
    "com.vrmc.univrm": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRM#v0.125.0",
    "com.vrmc.vrm": "https://github.com/vrm-c/UniVRM.git?path=/Assets/VRM10#v0.125.0",
    // ...
  }
}
```

### UnityPackage ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã®æ›´æ–°æ‰‹é †
1. UniVRM ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
2. UniVRM v0.125.0 ã® UnityPackage ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚

è©²å½“ã®ãƒ•ã‚©ãƒ«ãƒ€
- `Assets/VRMShaders`
- `Assets/UniGLTF`
- `Assets/VRM`
- `Assets/VRM10`

### UniVRM ã® Assembly Definition ã‚’å‚ç…§ã—ã¦ã„ã‚‹å ´åˆ
ä»¥ä¸‹ã® Assembly Definition ã‚’å‚ç…§ã—ã¦ã„ã‚‹å ´åˆã¯å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚

| before | after |
| -- | -- |
| `VRMShaders.GLTF.IO.Runtime.asmdef` | `UniGLTF.asmdef` |
| `VRMShaders.GLTF.IO.Editor.asmdef` | `UniGLTF.Editor.asmdef` |
| `VRMShaders.GLTF.IO.Tests.asmdef` | `UniGLTF.Tests.asmdef` |
| `VRMShaders.GLTF.UniUnlit.Runtime.asmdef` | `VRMShaders.GLTF.UniUnlit.asmdef` |
| `VRMShaders.GLTF.UniUnlit.Editor.asmdef` | `UniGLTF.UniUnlit.Editor.asmdef` |
| `VRMShaders.VRM.IO.Runtime.asmdef` | `VRM.asmdef` |
| `VRMShaders.VRM10.Format.Runtime.asmdef` | `VRM10.asmdef` |
| `VRMShaders.VRM10.MToon10.Runtime.asmdef` | `VRM10.MToon10.asmdef` |
| `VRMShaders.VRM10.MToon10.Editor.asmdef` | `VRM10.MToon10.Editor.asmdef` |
| `VRMShaders.VRM10.MToon10.Tests.asmdef` | `VRM10.MToon10.Tests.asmdef` |

### UniVRM ã® VRMShaders åå‰ç©ºé–“ã®å‹ã‚’å‚ç…§ã—ã¦ã„ã‚‹å ´åˆ
ä»¥ä¸‹ã® `VRMShaders.*` åå‰ç©ºé–“ã®å‹ã‚’å‚ç…§ã—ã¦ã„ã‚‹å ´åˆã¯å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚

| before | after |
| `VRMShaders.*` | `UniGLTF.*` |
| `UniGLTF.ShaderPropExporter.*` | `VRM.*` |
| `VRMShaders.VRM10.MToon10.Runtime.*` | `VRM10.MToon10.*` |
| `VRMShaders.VRM10.MToon10.Editor.*` | `VRM10.MToon10.Editor.*` |

:::note è©³ã—ã„å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã® PR ã‚’å‚ç…§
- https://github.com/vrm-c/UniVRM/pull/2365
- https://github.com/vrm-c/UniVRM/pull/2366
- https://github.com/vrm-c/UniVRM/pull/2367
- https://github.com/vrm-c/UniVRM/pull/2370
- https://github.com/vrm-c/UniVRM/pull/2372
- https://github.com/vrm-c/UniVRM/pull/2373
- https://github.com/vrm-c/UniVRM/pull/2377
:::

## `IMaterialDescriptorGenerator` ã®ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´ã«ã¨ã‚‚ãªã†å¯¾å¿œ

glTF, VRM0.X, VRM1.0 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‹¬è‡ªã®ã‚·ã‚§ãƒ¼ãƒ€ã‚’ç”¨ã„ã¦ Import ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®å¤‰æ›´ã«å¯¾å¿œã—ã¦ãã ã•ã„ã€‚

before
```csharp
public interface IMaterialDescriptorGenerator
{
    MaterialDescriptor Get(GltfData data, int i);
    MaterialDescriptor GetGltfDefault();
}
```

after
```csharp
public interface IMaterialDescriptorGenerator
{
    MaterialDescriptor Get(GltfData data, int i);
    MaterialDescriptor GetGltfDefault(string materialName = null);
}
```

:::note è©³ã—ã„å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã® PR ã‚’å‚ç…§
https://github.com/vrm-c/UniVRM/pull/2395
:::

## `Vrm10Exporter` ã®ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´ã«ã¨ã‚‚ãªã†å¯¾å¿œ

VRM 1.0 ã® Export æ©Ÿèƒ½ã‚’ç‹¬è‡ªã«å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®å¤‰æ›´ã«å¯¾å¿œã—ã¦ãã ã•ã„ã€‚

before
```csharp
public class Vrm10Exporter : IDisposable
{
    public Vrm10Exporter(
        ITextureSerializer textureSerializer,
        GltfExportSettings settings);

    public static byte[] Export(
        GameObject go,
        ITextureSerializer textureSerializer = null,
        VRM10ObjectMeta vrmMeta = null);
}
```

after
```csharp
public class Vrm10Exporter : IDisposable
{
    public Vrm10Exporter(
        GltfExportSettings settings,
        IMaterialExporter materialExporter = null,
        ITextureSerializer textureSerializer = null);

    public static byte[] Export(
        GameObject go,
        IMaterialExporter materialExporter = null,
        ITextureSerializer textureSerializer = null,
        VRM10ObjectMeta vrmMeta = null);
}
```

:::note è©³ã—ã„å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã® PR ã‚’å‚ç…§
https://github.com/vrm-c/UniVRM/pull/2390
:::